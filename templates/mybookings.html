{% extends "layout.html" %}
{% block title %}My Bookings{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/mybookings.css') }}">
{% endblock %}

{% block content %}

<div class="container pb-5 mt-5">

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="page-title">
        <i class="bi bi-luggage-fill text-primary"></i> My Trips
    </h2>
    <span class="text-muted">{{ bookings|length }} bookings</span>
</div>

{% with messages = get_flashed_messages() %}
{% if messages %}
<div class="alert alert-success rounded-pill px-4">
    {{ messages[0] }}
</div>
{% endif %}
{% endwith %}

<div class="row g-4">

{% if bookings %}

{% for b in bookings %}
<div class="col-12">

<div class="card booking-card shadow-sm p-4">

<div class="row align-items-center">

<div class="col-md-6">
    <h4 class="fw-bold mb-1">{{ b.title }}</h4>
    <p class="text-muted small mb-1">
        <i class="bi bi-calendar-event"></i> Travel Schedule:
        {{ b.departure_datetime or b.start_date or '-' }}{% if b.return_datetime %} → {{ b.return_datetime }}{% endif %}
    </p>
    <p class="text-muted small">
        <i class="bi bi-clock-history"></i> Booked On: {{ b.date }}
    </p>

    <div class="mt-2">
        <span class="badge bg-light text-dark border p-2">
            <i class="bi bi-credit-card"></i> ₹{{ b.price }}
        </span>
    </div>
</div>

<div class="col-md-6 text-md-end mt-3 mt-md-0">

    {% if b.status == 'paid' %}
        <span class="status-paid me-3">
            <i class="bi bi-check-circle"></i> Confirmed
        </span>
    {% else %}
        <span class="status-pending me-3">
            <i class="bi bi-hourglass-split"></i> Payment Pending
        </span>
    {% endif %}

    <div class="mt-3">

        <a href="{{ url_for('booking', tour_id=b.tour_id) }}"
           class="btn btn-main btn-view">
           View Plan
        </a>

        {% if b.status != 'paid' %}
        <a href="{{ url_for('payment', booking_id=b.id) }}"
           class="btn btn-main btn-pay ms-2">
           Complete Payment
        </a>
        {% endif %}

        {% if b.status == 'paid' %}
        <a href="{{ url_for('invoice', booking_id=b.id) }}"
           class="btn btn-main btn-bill ms-2">
           <i class="bi bi-download"></i> Bill
        </a>
        {% endif %}

    </div>

</div>

</div>
</div>
</div>
{% endfor %}

{% else %}

<div class="col-12 text-center empty-box">
    <i class="bi bi-calendar-x display-1 text-muted"></i>
    <h3 class="mt-4 text-muted">No bookings yet</h3>
    <a href="{{ url_for('tour') }}" class="btn btn-primary btn-lg rounded-pill mt-3 px-5">
        Explore Tours
    </a>
</div>

{% endif %}

</div>
</div>

{% endblock %}
