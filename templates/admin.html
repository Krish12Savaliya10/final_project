<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TourGen Admin Panel</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

<style>

body{
    background:#f1f5f9;
    font-family:'Segoe UI',system-ui;
}

/* TOP NAVBAR */
.admin-topbar{
    background:#0f172a;
    padding:12px 25px;
}

.admin-topbar .brand{
    color:white;
    font-weight:700;
    font-size:22px;
}

.admin-topbar .btn{
    border-radius:40px;
}

/* SECTION NAV */
.section-tabs{
    background:white;
    padding:12px;
    box-shadow:0 4px 10px rgba(0,0,0,.06);
}

.section-tabs button{
    border-radius:40px;
    margin-right:10px;
    font-weight:600;
}

/* CARDS */
.card{
    border-radius:18px;
}

.card img{
    height:180px;
    object-fit:cover;
}

/* TABLE */
.table img{
    object-fit:cover;
}

/* ITINERARY ROW */
#itinerary-list .card{
    background:#f8fafc;
    border:1px dashed #cbd5e1;
}

</style>
</head>

<body>

<!-- TOP BAR -->
<div class="admin-topbar d-flex justify-content-between align-items-center">
    <div class="brand">
        <i class="bi bi-compass"></i> TourGen Admin
    </div>

    <div>
        <a href="{{ url_for('home') }}" class="btn btn-outline-light btn-sm me-2">
            <i class="bi bi-globe"></i> View Website
        </a>
        <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">
            Logout
        </a>
    </div>
</div>

<!-- SECTION TABS -->
<div class="section-tabs text-center">
    <button class="btn btn-primary" onclick="showSection('tours')">Manage Tours</button>
    <button class="btn btn-dark" onclick="showSection('library')">Places Library</button>
</div>

<div class="container py-4">

<!-- ================= TOURS SECTION ================= -->
<div id="tours">

<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold">Active Tour Packages</h3>
    <button class="btn btn-success rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#tourModal">
        <i class="bi bi-plus-lg"></i> Create Tour
    </button>
</div>

<div class="row g-4">
{% for tour in tours %}
<div class="col-md-4">
<div class="card shadow-sm h-100">

<img src="{{ url_for('static', filename='uploads/' + (tour.image_path or 'demo.jpg')) }}">

<div class="card-body">
<h5 class="fw-bold">{{ tour.title }}</h5>
<p class="text-muted small">{{ tour.start_point }} ➜ {{ tour.end_point }}</p>

<div class="d-flex justify-content-between align-items-center">
<span class="text-primary fw-bold">₹{{ tour.price }}</span>
<span class="badge bg-light text-dark border">{{ tour.start_date }}</span>
</div>

</div>
</div>
</div>
{% endfor %}
</div>
</div>

<!-- ================= LIBRARY SECTION ================= -->
<div id="library" style="display:none">

<h3 class="fw-bold mb-3">Hierarchy Library</h3>

<div class="row g-3 mb-4">
<div class="col-md-4">
<button class="btn btn-dark w-100" data-bs-toggle="modal" data-bs-target="#stateModal">Add State</button>
</div>
<div class="col-md-4">
<button class="btn btn-dark w-100" data-bs-toggle="modal" data-bs-target="#cityModal">Add City</button>
</div>
<div class="col-md-4">
<button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#spotModal">Add Spot</button>
</div>
</div>

<div class="card p-4 shadow-sm">
<table class="table table-hover align-middle">

<thead class="table-dark">
<tr>
<th>State</th>
<th>City</th>
<th>Spot</th>
<th>Image</th>
</tr>
</thead>

<tbody>
{% for s in spots %}
<tr>
<td><span class="badge bg-secondary">{{ s.state_name }}</span></td>
<td>{{ s.city_name }}</td>
<td>{{ s.spot_name }}</td>
<td>
<img src="{{ url_for('static', filename='uploads/' + (s.image_url or 'demo.jpg')) }}"
width="50" height="50" class="rounded">
</td>
</tr>
{% endfor %}
</tbody>

</table>
</div>
</div>

</div>

<!-- ================= ADD STATE ================= -->
<div class="modal fade" id="stateModal">
<div class="modal-dialog">
<form class="modal-content" method="POST">
<input type="hidden" name="action" value="add_state">
<div class="modal-header"><h5>Add State</h5></div>
<div class="modal-body">
<input type="text" name="state_name" class="form-control" placeholder="Example: Gujarat" required>
</div>
<div class="modal-footer">
<button class="btn btn-primary">Save</button>
</div>
</form>
</div>
</div>

<!-- ================= ADD CITY ================= -->
<div class="modal fade" id="cityModal">
<div class="modal-dialog">
<form class="modal-content" method="POST">
<input type="hidden" name="action" value="add_city">
<div class="modal-header"><h5>Add City</h5></div>
<div class="modal-body">

<select name="state_id" class="form-select mb-3" required>
<option value="">Select State</option>
{% for s in states %}
<option value="{{ s.id }}">{{ s.state_name }}</option>
{% endfor %}
</select>

<input type="text" name="city_name" class="form-control" placeholder="Example: Udaipur" required>
</div>
<div class="modal-footer">
<button class="btn btn-primary">Save</button>
</div>
</form>
</div>
</div>

<!-- ================= ADD SPOT ================= -->
<div class="modal fade" id="spotModal">
<div class="modal-dialog">
<form class="modal-content" method="POST" enctype="multipart/form-data">
<input type="hidden" name="action" value="add_spot">

<div class="modal-header"><h5>Add Tourist Spot</h5></div>

<div class="modal-body">

<select name="city_id" class="form-select mb-3" required>
<option value="">Select City</option>
{% for c in cities %}
<option value="{{ c.id }}">{{ c.state_name }} ➜ {{ c.city_name }}</option>
{% endfor %}
</select>

<input type="text" name="spot_name" class="form-control mb-3" placeholder="Example: City Palace">

<input type="file" name="spot_image" class="form-control" accept="image/*">

</div>

<div class="modal-footer">
<button class="btn btn-primary">Save</button>
</div>
</form>
</div>
</div>

<!-- ================= CREATE TOUR ================= -->
<div class="modal fade" id="tourModal">
<div class="modal-dialog modal-lg">
<form class="modal-content" method="POST" enctype="multipart/form-data">
<input type="hidden" name="action" value="add_tour">

<div class="modal-header bg-primary text-white">
<h5>Create New Tour</h5>
</div>

<div class="modal-body">

<div class="row g-3 mb-3">
<div class="col-md-8">
<input type="text" name="title" class="form-control" placeholder="Tour Title" required>
</div>
<div class="col-md-4">
<input type="number" name="price" class="form-control" placeholder="Base Price" required>
</div>
</div>

<textarea name="description" class="form-control mb-3" placeholder="Tour Description"></textarea>

<div class="row g-3 mb-3">
<div class="col-md-6">
<input type="text" name="start_point" class="form-control" placeholder="Start Point" required>
</div>
<div class="col-md-6">
<input type="text" name="end_point" class="form-control" placeholder="End Point" required>
</div>
</div>

<div class="row g-3 mb-3">
<div class="col-md-6">
<input type="date" name="start_date" class="form-control" required>
</div>
<div class="col-md-6">
<input type="date" name="end_date" class="form-control" required>
</div>
</div>

<hr>

<h6 class="fw-bold">Itinerary</h6>

<div id="itinerary-list"></div>

<button type="button" class="btn btn-outline-primary mt-2" onclick="addItineraryRow()">+ Add Spot</button>

<div class="mt-3">
<input type="file" name="tour_image" class="form-control">
</div>

</div>

<div class="modal-footer">
<button class="btn btn-success w-100">Publish Tour</button>
</div>

</form>
</div>
</div>

<script>

function showSection(id){
document.getElementById('tours').style.display='none';
document.getElementById('library').style.display='none';
document.getElementById(id).style.display='block';
}

function addItineraryRow(){
const container=document.getElementById('itinerary-list');
const id=Date.now();

container.innerHTML+=`
<div class="card p-3 mb-2">
<div class="row g-2">

<div class="col-md-2">
<input type="number" name="day_numbers[]" class="form-control" value="1" required>
</div>

<div class="col-md-4">
<select name="spots[]" class="form-select" required>
<option value="">Select Spot</option>
{% for s in spots %}
<option value="{{ s.id }}">{{ s.state_name }} ➜ {{ s.city_name }} ➜ {{ s.spot_name }}</option>
{% endfor %}
</select>
</div>

<div class="col-md-2">
<button type="button" class="btn btn-danger w-100" onclick="this.closest('.card').remove()">Remove</button>
</div>

</div>
</div>`;
}

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>