{% extends "layout.html" %}
{% block title %}Manage Hotel Rooms{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/provider_hotels_management.css') }}">
{% endblock %}

{% block content %}
<div class="container mt-5 pb-5">
  <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
    <h2 class="fw-bold mb-0">Hotel Room Availability Management</h2>
    <a href="{{ url_for('provider_dashboard') }}" class="btn btn-outline-primary rounded-pill">Back to Provider Dashboard</a>
  </div>

  {% with messages = get_flashed_messages() %}
  {% if messages %}
  <div class="alert alert-info border-0 shadow-sm">{{ messages[0] }}</div>
  {% endif %}
  {% endwith %}

  <div class="row g-3 mb-4">
    <div class="col-md-4"><div class="cardx p-3"><div class="small-muted">Total Hotels</div><div class="stat">{{ hotel_stats.total_hotels or 0 }}</div></div></div>
    <div class="col-md-4"><div class="cardx p-3"><div class="small-muted">Total Rooms</div><div class="stat">{{ hotel_stats.total_rooms or 0 }}</div></div></div>
    <div class="col-md-4"><div class="cardx p-3"><div class="small-muted">Available Rooms</div><div class="stat text-success">{{ hotel_stats.available_rooms or 0 }}</div></div></div>
  </div>

  <div class="cardx p-3 mb-4">
    <h5 class="fw-bold mb-3">All Hotels Overview</h5>
    {% if hotels %}
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead>
          <tr><th>Hotel</th><th>Location</th><th>Star</th><th>Price</th><th>Total</th><th>Available</th><th>Public View</th></tr>
        </thead>
        <tbody>
          {% for h in hotels %}
          <tr>
            <td><strong>{{ h.hotel_name }}</strong></td>
            <td><small>{{ h.locality or h.address_line1 }}<br>{{ h.city_name or '-' }}</small></td>
            <td>{{ h.star_rating }}â˜…</td>
            <td>Rs {{ h.min_price }}</td>
            <td>{{ h.total_rooms }}</td>
            <td>
              {% if h.available_rooms > 0 %}
                <span class="badge bg-success">{{ h.available_rooms }}</span>
              {% else %}
                <span class="badge bg-danger">0</span>
              {% endif %}
            </td>
            <td><a href="{{ url_for('hotel_detail', service_id=h.service_id) }}" class="btn btn-sm btn-outline-dark">Open</a></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="alert alert-light border mb-0">No hotel listings available.</div>
    {% endif %}
  </div>

  <div class="cardx p-3 mb-4">
    <h5 class="fw-bold mb-3">Update Room Availability (Type-wise)</h5>
    {% if room_types %}
    <div class="table-responsive">
      <table class="table table-striped align-middle mb-0">
        <thead>
          <tr><th>Hotel</th><th>Room Type</th><th>Total</th><th>Current Available</th><th>Set New Count</th></tr>
        </thead>
        <tbody>
          {% for r in room_types %}
          <tr>
            <td>{{ r.hotel_name }}</td>
            <td>{{ r.room_type_name }}</td>
            <td>{{ r.total_rooms }}</td>
            <td><span class="badge bg-info text-dark">{{ r.available_rooms }}</span></td>
            <td>
              <form method="POST" class="d-flex flex-wrap gap-2">
                <input type="hidden" name="room_type_id" value="{{ r.id }}">
                <input type="number" name="new_available" min="0" max="{{ r.total_rooms }}" value="{{ r.available_rooms }}" class="form-control form-control-sm inv-count-input" required>
                <input type="text" name="note" class="form-control form-control-sm inv-note-input" placeholder="note (optional)">
                <button class="btn btn-primary btn-sm">Save</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="alert alert-light border mb-0">No room types found.</div>
    {% endif %}
  </div>

  <div class="cardx p-3">
    <h5 class="fw-bold mb-3">Recent Availability Changes</h5>
    {% if logs %}
    <div class="table-responsive">
      <table class="table table-sm align-middle mb-0">
        <thead>
          <tr><th>Date</th><th>Hotel</th><th>Room Type</th><th>Old</th><th>New</th><th>Note</th></tr>
        </thead>
        <tbody>
          {% for l in logs %}
          <tr>
            <td><small>{{ l.created_at }}</small></td>
            <td>{{ l.hotel_name }}</td>
            <td>{{ l.room_type_name }}</td>
            <td>{{ l.old_available }}</td>
            <td>{{ l.new_available }}</td>
            <td>{{ l.note or '-' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="alert alert-light border mb-0">No inventory updates yet.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
