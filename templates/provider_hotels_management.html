{% extends "layout.html" %}
{% block title %}Manage Hotels{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/provider_hotels_management.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/role_dashboard.css') }}">
{% endblock %}

{% block content %}
{% set provider_sidebar_active = 'manage_hotels' %}
<div class="container mt-5 pb-5 dashboard-shell dashboard-page provider-dashboard-page">
  <div class="provider-shell">
    {% include "provider_sidebar.html" %}
    <main class="provider-main">
      <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2 provider-header">
        <h2 class="fw-bold mb-0">Manage Hotels</h2>
        <div class="d-flex flex-wrap gap-2">
          <a href="{{ url_for('provider_add_hotel') }}" class="btn btn-primary btn-sm rounded-pill">Add Hotel</a>
          <a href="{{ url_for('provider_dashboard') }}" class="btn btn-outline-secondary btn-sm rounded-pill">Dashboard</a>
        </div>
      </div>

      {% with messages = get_flashed_messages() %}
      {% if messages %}
      <div class="alert alert-info border-0 shadow-sm">{{ messages[0] }}</div>
      {% endif %}
      {% endwith %}

      <div class="card panel-card mb-4">
        <div class="card-body">
          <h5 class="fw-bold mb-3">Hotel List</h5>
          {% if hotels %}
          <div class="table-responsive">
            <table class="table table-striped align-middle mb-0">
              <thead>
                <tr>
                  <th>Photo</th>
                  <th>Hotel</th>
                  <th>Location</th>
                  <th>Contact</th>
                  <th>Rooms</th>
                  <th>Price</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for h in hotels %}
                {% set cover_src = h.cover_image if h.cover_image and (h.cover_image.startswith('http://') or h.cover_image.startswith('https://')) else url_for('static', filename='uploads/' + (h.cover_image or 'demo.jpg')) %}
                {% set status = (h.listing_status or 'active') %}
                <tr>
                  <td>
                    <img src="{{ cover_src }}" alt="{{ h.hotel_name }}" class="hotel-manage-thumb">
                  </td>
                  <td>
                    <div class="fw-semibold">{{ h.hotel_name }}</div>
                    <div class="small text-muted">{{ h.star_rating or 0 }}★ | {{ h.photo_count or 0 }} photo(s)</div>
                  </td>
                  <td>
                    <div>{{ h.city_name or '-' }}, {{ h.state_name or '-' }}</div>
                    <div class="small text-muted">{{ h.locality or h.address_line1 or '-' }}</div>
                  </td>
                  <td>
                    <div>{{ h.owner_name or '-' }}</div>
                    <div class="small text-muted">{{ h.hotel_contact_phone or '-' }}</div>
                    <div class="small text-muted">{{ h.hotel_contact_email or '-' }}</div>
                  </td>
                  <td>{{ h.available_rooms }} / {{ h.total_rooms }}</td>
                  <td>₹{{ h.min_price }}</td>
                  <td><span class="badge status-badge text-capitalize status-{{ status }}">{{ status }}</span></td>
                  <td>
                    <div class="d-flex flex-column gap-2">
                      <a href="{{ url_for('provider_hotel_manage_detail', service_id=h.service_id) }}" class="btn btn-sm btn-primary">View Details</a>
                      <a href="{{ url_for('hotel_detail', service_id=h.service_id) }}" class="btn btn-sm btn-outline-primary">Public View</a>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="alert alert-light border mb-0">No hotel listings available.</div>
          {% endif %}
        </div>
      </div>

      <div class="card panel-card">
        <div class="card-body">
          <h5 class="fw-bold mb-3">Update Room Availability</h5>
          {% if room_types %}
          <div class="table-responsive">
            <table class="table table-striped align-middle mb-0">
              <thead>
                <tr><th>Hotel</th><th>Room Type</th><th>Total</th><th>Current Available</th><th>Set New Count</th></tr>
              </thead>
              <tbody>
                {% for r in room_types %}
                <tr>
                  <td>{{ r.hotel_name }}</td>
                  <td>{{ r.room_type_name }}</td>
                  <td>{{ r.total_rooms }}</td>
                  <td><span class="badge bg-info text-dark">{{ r.available_rooms }}</span></td>
                  <td>
                    <form method="POST" class="d-flex flex-wrap gap-2">
                      <input type="hidden" name="room_type_id" value="{{ r.id }}">
                      <input type="number" name="new_available" min="0" max="{{ r.total_rooms }}" value="{{ r.available_rooms }}" class="form-control form-control-sm inv-count-input" required>
                      <input type="text" name="note" class="form-control form-control-sm inv-note-input" placeholder="note (optional)">
                      <button class="btn btn-primary btn-sm">Save</button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="alert alert-light border mb-0">No room types found.</div>
          {% endif %}
        </div>
      </div>
    </main>
  </div>
</div>
{% endblock %}
