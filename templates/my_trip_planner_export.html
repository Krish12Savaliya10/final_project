<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ plan.plan_title }} | Export</title>
<style>
body{font-family:Arial,sans-serif;padding:24px;color:#111;}
.head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px;}
.muted{color:#666;font-size:12px;}
.meta{margin:10px 0 16px;padding:10px;border:1px solid #ddd;border-radius:8px;}
.badge{display:inline-block;padding:4px 8px;border:1px solid #bbb;border-radius:999px;font-size:12px;margin-right:6px;}
.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;}
.card{border:1px solid #ddd;border-radius:8px;overflow:hidden;}
.thumb{width:100%;height:160px;object-fit:cover;display:block;}
.body{padding:10px;}
.title{font-weight:700;}
@media print {
  .no-print{display:none;}
}
</style>
</head>
<body>
  <div class="head">
    <div>
      <h2 style="margin:0 0 4px 0;">{{ plan.plan_title }}</h2>
      <div class="muted">Self Organized Trip Plan</div>
    </div>
    <button class="no-print" onclick="window.print()">Print / Save as PDF</button>
  </div>

  <div class="meta">
    <div><strong>City:</strong> {% if plan.city_name %}{{ plan.city_name }}{% if plan.state_name %}, {{ plan.state_name }}{% endif %}{% else %}Multi-city{% endif %}</div>
    <div><strong>Dates:</strong> {% if plan.start_date %}{{ plan.start_date }}{% else %}-{% endif %} to {% if plan.end_date %}{{ plan.end_date }}{% else %}-{% endif %}</div>
    <div style="margin-top:6px;">
      {% if plan.hotel_service_name %}<span class="badge">Hotel: {{ plan.hotel_service_name }}</span>{% endif %}
    </div>
    {% if plan.notes %}<div style="margin-top:8px;"><strong>Notes:</strong> {{ plan.notes }}</div>{% endif %}
  </div>

  {% if items %}
  <div class="grid">
    {% for it in items %}
    <div class="card">
      {% if it.photo_source == 'external_url' %}
      <img class="thumb" src="{{ it.image_url }}"
           onerror="this.onerror=null;this.src='{{ url_for('static', filename='uploads/demo.jpg') }}';"
           alt="{{ it.spot_name }}">
      {% else %}
      <img class="thumb" src="{{ url_for('static', filename='uploads/' + (it.image_url or 'demo.jpg')) }}"
           onerror="this.onerror=null;this.src='{{ url_for('static', filename='uploads/demo.jpg') }}';"
           alt="{{ it.spot_name }}">
      {% endif %}
      <div class="body">
        <div class="muted">Day {{ it.day_number }}</div>
        <div class="title">{{ it.spot_name }}</div>
        <div class="muted">{{ it.city_name }}, {{ it.state_name }}</div>
        {% if it.note %}<div style="margin-top:6px;">{{ it.note }}</div>{% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p>No spots added in this plan.</p>
  {% endif %}
</body>
</html>
