<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>TourGen | Join Trip</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <style>
    body {
      background-color: #f8f9fa;
      padding-top: 80px;
    }

    .card {
      border: none;
      border-radius: 15px;
      margin-bottom: 20px;
    }

    .price-badge {
      font-size: 1.5rem;
      color: #0d6efd;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="{{ url_for('home') }}"><i>TourGen</i></a>
    </div>
  </nav>

  <div class="container my-5">
    <div class="row g-4">
      <div class="col-lg-8">
        <div class="card shadow p-4">
          <h2 class="fw-bold">{{ tour.title }}</h2>
          <p class="text-muted">{{ tour.description }}</p>
          <div class="d-flex gap-3 mt-2">
            <span class="badge bg-light text-dark border"><i class="bi bi-calendar-event me-1"></i> Starts: {{
              tour.start_date }}</span>
            <span class="badge bg-light text-dark border"><i class="bi bi-geo-alt me-1"></i> From: {{ tour.start_point
              }}</span>
          </div>
        </div>

        <div class="card shadow p-4">
          <h4 class="fw-bold mb-3">Upgrade Your Experience</h4>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label small fw-bold">Transport Type</label>
              <select class="form-select" id="car" onchange="calculateTotal()">
                <option value="0">Default (Bus) – Included</option>
                <option value="1500">Private Hatchback – +₹1500</option>
                <option value="2500">Private Sedan – +₹2500</option>
                <option value="4000">Private SUV – +₹4000</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label small fw-bold">Hotel Category</label>
              <select class="form-select" id="hotel" onchange="calculateTotal()">
                <option value="0">Standard – Included</option>
                <option value="2000">Deluxe – +₹2000</option>
                <option value="5000">Premium Luxury – +₹5000</option>
              </select>
            </div>
          </div>
          <div class="mt-2">
            <label class="form-label small fw-bold">Number Of People</label>
            <input type="number" class="form-control" id="people" value="1" min="1" oninput="calculateTotal()"
              style="max-width: 150px;">
          </div>
        </div>

        <div class="card shadow p-4">
          <h4 class="fw-bold mb-3"><i class="bi bi-map me-2"></i>Daily Plan</h4>
          <div class="list-group list-group-flush">
            {% for item in itinerary %}
            <div class="list-group-item d-flex align-items-center p-3 border-bottom">

              <img
                src="{{ item.image_url if item.image_url.startswith('http') else url_for('static', filename='uploads/' + item.image_url) }}"
                class="rounded shadow-sm me-3" style="width: 70px; height: 70px; object-fit: cover;"
                alt="{{ item.spot_name }}">

              <div class="flex-grow-1">
                <span class="badge bg-primary rounded-pill mb-1">Day {{ item.day_number }}</span>
                <h6 class="fw-bold mb-0 text-dark">{{ item.spot_name }}</h6>
              </div>

              <i class="bi bi-check-circle-fill text-success fs-5"></i>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card shadow p-4 sticky-top" style="top: 100px;">
          <h4 class="fw-bold mb-4">Price Summary</h4>
          <div class="d-flex justify-content-between mb-2">
            <span>Base Price:</span>
            <span class="fw-bold">₹{{ tour.price }}</span>
          </div>
          <div class="d-flex justify-content-between mb-4 border-top pt-3">
            <span class="h5">Total:</span>
            <span class="price-badge">₹<span id="totalPrice">0</span></span>
          </div>

          <form method="POST">
            <input type="hidden" name="final_amount" id="finalAmountInput">
            <button type="submit" class="btn btn-primary btn-lg w-100 rounded-pill shadow-sm py-3 fw-bold">
              JOIN TOUR NOW
            </button>
          </form>
          <p class="text-center text-muted mt-3 small">
            <i class="bi bi-shield-check me-1"></i> Fixed Departure: {{ tour.start_date }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <div id="tour-data" data-price="{{ tour.price | default(0) }}"></div>

  <script>
    // 1. Get data safely
    const tourData = document.getElementById('tour-data');
    const basePrice = Number(tourData.getAttribute('data-price'));

    // 2. Calculation Logic
    function calculateTotal() {
      const peopleInput = document.getElementById("people");
      const people = peopleInput.value || 1;

      const hotelAddon = document.getElementById("hotel").value;
      const carAddon = document.getElementById("car").value;

      const total = (Number(basePrice) + Number(hotelAddon) + Number(carAddon)) * Number(people);

      document.getElementById("totalPrice").textContent = total.toLocaleString();
      document.getElementById("finalAmountInput").value = total;
    }

    calculateTotal();
  </script>

</body>

</html>